/**
 * Kollus VG Controller Client (10-24-2018)
 * Copyright (c) 2018, Catenoid Incorporated. All rights reserved.
 *
 * @version 1.0.4 (1316)
 * @license ISC
 */


!function(a){"use strict";a.Modules||(a.Modules={storage:{},add:function(b,c,d){var e=b,f=function(b,c,d,e){var g=b.split("."),h=g.shift();e=e||a.Modules.storage,e[h]=e[h]||{},g.length>0?f(g.join("."),c,d,e[h]):e[h][c]=d()};f(e,c,d)},get:function(b,c){if(void 0===b||void 0===c)throw new Error("Modules.get method must called with module name and namespace param.");for(var d=b.split("."),e=a.Modules.storage,f=0;f<d.length;f++){e=e[d[f]]}return e[c]}})}(window),function(a){Modules.add("com.kollus.vgcontroller","Config",a)}(function(){"use strict";return{debug_mode:!1,max_initialize_count:10,progress:{percent:0,position:0,duration:0},screen:"windowed",volume:50,muted:!1,jumpstep:10,scalemode:"letterbox",control_visibility:!0,video_visibility:!0,speed:1,playback_rates:"[0.5, 1, 1.5, 2]",topmost:!1,video:{brightness:0,contrast:0,saturation:0},subtitle_visibility:!0}}),function(a){Modules.add("com.kollus.vgcontroller","PLAYER_TYPE",a)}(function(){"use strict";return{V2:"v2",V3:"v3",V4:"v4",FLASH:"flash",VIDEOJS:"videojs",KOLLUS:"kollus"}}),function(a){Modules.add("com.kollus.vgcontroller","Util",a)}(function(){"use strict";return{isArray:function(a){return!!a&&"[object Array]"===Object.prototype.toString.call(a)},isObject:function(a){return!!a&&"[object Object]"===Object.prototype.toString.call(a)},isString:function(a){return"string"==typeof a},mergeObject:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},hasValueInObject:function(a,b){for(var c in a)if(b===a[c])return!0;return!1},queryString:function(a,b){for(var c,d=[],e=!1,f=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<f.length;g++)c=f[g].split("="),d.push(c[0]),d[c[0]]=c[1],c[0]===a&&(e=!0);return b?e:a?d[a]:d}}}),function(a){Modules.add("com.kollus.vgcontroller","Logger",a)}(function(){"use strict";var a,b=Modules.get("com.kollus.vgcontroller","Config"),c=!!b&&Modules.get("com.kollus.vgcontroller","Config").debug_mode,d=function(b,d,e,f){c&&(window.console||(console={log:function(){}}),e?d="["+e+"] "+d:a&&(d="["+a+"] "+d),console[b](d),f&&alert(d))};return{defaultPrefix:function(b){a=b},log:function(a,b,c){d("log",a,b,c)},info:function(a,b,c){d("info",a,b,c)},warn:function(a,b,c){d("warn",a,b,c)},error:function(a,b,c){d("error",a,b,c)}}}),function(a){Modules.add("com.kollus.vgcontroller","VgControllerLibrary",a)}(function(){"use strict";var a,b,c,d,e,f,g=window.KollusPostMessageException=function(a,b){this.message=a,this.code=b||-1,this.toString=function(){return this.message+" ["+this.code+"]"}},h=(Modules.get("com.kollus.vgcontroller","Config"),Modules.get("com.kollus.vgcontroller","Util")),i=Modules.get("com.kollus.vgcontroller","Logger"),j=Modules.get("com.kollus.vgcontroller","PLAYER_TYPE"),k={target_window:null,target_origin:"*"};window.vg_controller_uid=window.vg_controller_uid||0;var l=function(i,l,m){if(void 0===window.postMessage)throw new g("this browser does not support postMessage",-99);if(l.hasOwnProperty("player_type")){if(!h.hasValueInObject(Modules.get("com.kollus.vgcontroller","PLAYER_TYPE"),l.player_type))throw new g("player_type must be one of v2, v3, v4 and flash.",-99)}else l.player_type=j.KOLLUS;a=i,b=h.mergeObject(k,l),e={},c=b.player_type,d=null,b.use_uid_check&&(d=b.player_type+"-postmessage-"+window.vg_controller_uid++),f=[],window.addEventListener?window.addEventListener("message",function(a){Modules.get("com.kollus.vgcontroller","VgControllerLibrary").receive(a)},!1):window.attachEvent("onmessage",function(a){Modules.get("com.kollus.vgcontroller","VgControllerLibrary").receive(a)}),m()};return{init:function(a,b,c){return l(a,b,c)},getVersion:function(){return"1.0.4"},getPlayerType:function(){return c},on:function(a,b){if("function"!=typeof b)throw new g("listener is not callable.",-99);return void 0===e[a]&&(e[a]=[]),e[a].push(b),Modules.get("com.kollus.vgcontroller","VgControllerLibrary")},off:function(a){if(void 0!==e[a]){for(var b=0,c=e[a].length;b<c;b++)e[a][b]=null;e[a]=[]}return Modules.get("com.kollus.vgcontroller","VgControllerLibrary")},trigger:function(){if(arguments.length>=1){var a=Array.prototype.slice.call(arguments),b=a.shift();if(void 0!==e[b])for(var c=0,d=e[b].length;c<d;c++)e[b][c].apply(this,a)}},sendBufferedData:function(){var a=f.slice();for(f.length=0;a.length>0;){var b=a.shift();i.log("Send buffered data : "+b),Modules.get("com.kollus.vgcontroller","VgControllerLibrary").send(b[0],b[1])}},push:function(a,b){f.push([a,b])},send:function(a,c){if(null===d)return f.push([a,c]),!1;if(f.length>0)return f.push([a,c]),Modules.get("com.kollus.vgcontroller","VgControllerLibrary").sendBufferedData();if(null!==b.target_window){var e="client"===b.controller_type?"c_":"e_";i.log("[SEND] event_name: "+e+a+", data: "+JSON.stringify(c)+", uid: "+d);var g={event_name:e+a,uid:d};return void 0!==c&&(g.data=c),b.target_window.postMessage(JSON.stringify(g),b.target_origin)}return!1},receive:function(a){if("*"!==b.target_origin&&b.target_origin!==a.origin)return i.error("[RECEIVE] - event received, but origin not match. (target_origin: "+b.target_origin+", event.origin: "+a.origin+")"),!1;try{var c=JSON.parse(a.data),e=c.data;if(!0===b.use_uid_check&&d!==c.uid)return i.error("[RECEIVE] - not matched uid. this.uid -> "+this.uid+", message.uid -> "+c.uid),!1;!1===b.use_uid_check&&null===d&&(i.warn("[RECEIVE] - no use_uid_check. message.uid will be set to this.uid. mesasge.uid -> "+c.uid),d=c.uid),b.is_child&&null===b.target_window&&(i.warn("[RECEIVE] - this window is child. target_window will be set as event.source."),b.target_window=a.source),i.log("[RECEIVE] event_name: "+c.event_name+", data: "+JSON.stringify(e)+", uid: "+d),Modules.get("com.kollus.vgcontroller","VgControllerLibrary").trigger(c.event_name,e)}catch(a){throw new g(a.message,-1)}}}}),function(a){Modules.add("com.kollus.vgcontroller","CacheStorage",a)}(function(){"use strict";var a="com.kollus.vgcontroller",b=Modules.get(a,"Config"),c=(Modules.get(a,"Util"),{});return{namespace:function(){return a},set_progress:function(a){c.progress=a},get_progress:function(){return void 0!==c.progress?c.progress:b.progress},set_screen:function(a){c.screen=a},get_screen:function(){return void 0!==c.screen?c.screen:b.screen},set_volume:function(a){c.volume=a},get_volume:function(){return void 0!==c.volume?c.volume:b.volume},set_muted:function(a){c.muted=a},get_muted:function(){return void 0!==c.muted?c.muted:b.muted},set_jumpstep:function(a){c.jumpstep=a},get_jumpstep:function(){return void 0!==c.jumpstep?c.jumpstep:b.jumpstep},set_scalemode:function(a){c.scalemode=a},get_scalemode:function(){return void 0!==c.scalemode?c.scalemode:b.scalemode},set_control_visibility:function(a){c.control_visibility=a},get_control_visibility:function(){return void 0!==c.control_visibility?c.control_visibility:b.control_visibility},set_video_visibility:function(a){c.video_visibility=a},get_video_visibility:function(){return void 0!==c.video_visibility?c.video_visibility:b.video_visibility},set_speed:function(a){c.speed=a},get_speed:function(){return void 0!==c.speed?c.speed:b.speed},set_playback_rates:function(a){c.playback_rates=a},get_playback_rates:function(){return void 0!==c.playback_rates?c.playback_rates:b.playback_rates},set_topmost:function(a){c.topmost=a},get_topmost:function(){return void 0!==c.topmost?c.topmost:b.topmost},set_video:function(a){c.video=a},get_video:function(){return void 0!==c.video?c.video:b.video},set_subtitle_visibility:function(a){c.subtitle_visibility=a},get_subtitle_visibility:function(){return void 0!==c.subtitle_visibility?c.subtitle_visibility:b.subtitle_visibility},set_player_id:function(a){c.player_id=a},get_player_id:function(){return c.player_id||null},set_player_type:function(a){c.player_type=a},get_player_type:function(){return c.player_type||null},set_hardware_id:function(a){c.hardware_id=a},get_hardware_id:function(){return c.hardware_id||null},set_video_info:function(a){c.video_info=a},get_video_info:function(){return c.video_info||null},set_enable_close_event:function(a){c.enable_close_event=a},get_enable_close_event:function(){return c.enable_close_event||!1},set_close_callback_fn:function(a){c.close_callback_fn=a},get_close_callback_fn:function(){return c.close_callback_fn||null},set_lms_data_callback_fn:function(a){c.get_lms_data_fn=a},get_lms_data_callback_fn:function(){return c.get_lms_data_fn||null}}});var VgControllerClient=function(a){"use strict";this.namespace="com.kollus.vgcontroller";var b=Modules.get(this.namespace,"Config"),c=Modules.get(this.namespace,"Logger"),d=Modules.get(this.namespace,"Util"),e=Modules.get(this.namespace,"CacheStorage"),f=Modules.get(this.namespace,"VgControllerLibrary"),g={controller_type:"client",use_uid_check:!0,is_child:!1},h=(window.KollusVideogatewayControllerException=function(a,b){this.message=a,this.code=b||-1,this.toString=function(){return this.message+" ["+this.code+"]"}},function(){f.init(null,d.mergeObject(g,a),i);var b=j();for(var c in b)f.on("e_"+c,b[c])}),i=function(){c.defaultPrefix("VG Controller Client"),c.log("Connect to server...");var a=!1,d=0;f.on("e_initialized",function(b){a=!0,e.set_player_type(b)});var g=setInterval(function(){a?(clearInterval(g),c.log("Initialize success.")):++d>=b.max_initialize_count?(clearInterval(g),c.log("Initialize failed. max initialize try reached.")):(c.log("Send initialize command. try "+d+" time..."),f.send("initialize",!0))},1e3)},j=function(){return{ready:function(){f.trigger("ready"),f.send("set_close_callback_fn",e.get_close_callback_fn())},loaded:function(){f.trigger("loaded")},play:function(){f.trigger("play")},pause:function(){f.trigger("pause")},done:function(){f.trigger("done")},muted:function(a){e.set_muted(a),f.trigger("muted",a)},progress:function(a){var b=1*a.percent,c=1*a.position,d=1*a.duration;e.set_progress({percent:b,position:c,duration:d}),f.trigger("progress",b,c,d)},speedchange:function(a){e.set_speed(a),f.trigger("speedchange",a)},screenchange:function(a){e.set_screen(a),f.trigger("screenchange",a)},volumechange:function(a){e.set_volume(1*a),f.trigger("volumechange",1*a)},fullscreenchange:function(a){f.trigger("screenchange",a)},error:function(a){f.trigger("error",a)},jumpstepchange:function(a){e.set_jumpstep(1*a),f.trigger("jumpstepchange",1*a)},scalemodechange:function(a){e.set_scalemode(a),f.trigger("scalemodechange",a)},topmostchange:function(a){e.set_topmost(a),f.trigger("topmostchange",a)},videosettingchange:function(a){e.set_video(a),f.trigger("videosettingchange",a)},html5_video_supported:function(a){f.trigger("html5_video_supported",a)},playbackrateschange:function(a){e.set_playback_rates(a),f.trigger("playbackrateschange",a)},subtitlevisibilitychange:function(a){e.set_subtitle_visibility(a),f.trigger("subtitlevisibilitychange",a)},fetch_player_id:function(a){e.set_player_id(a)},fetch_hardware_id:function(a){e.set_hardware_id(a)},fetch_video_info:function(a){e.set_video_info(a)},fetch_get_lms_data:function(a){e.get_lms_data_callback_fn()(a)}}};return h(),{init:function(a){h()},connect:function(){i()},getVersion:function(){return f.getVersion()},on:function(a,b){return f.on(a,b)},off:function(a){return f.off(a)},get_progress:function(){return e.get_progress()},play:function(a){f.send("play",a)},pause:function(){f.send("pause")},mute:function(){f.send("mute")},ff:function(){f.send("ff")},rw:function(){f.send("rw")},set_volume:function(a){f.send("set_volume",Math.min(100,Math.max(0,a)))},get_volume:function(){return e.get_volume()},set_screen:function(){f.send("set_screen")},get_screen:function(){return e.get_screen()},set_jumpstep:function(a){f.send("set_jumpstep",a),e.set_jumpstep(1*a)},get_jumpstep:function(){return e.get_jumpstep()},set_control_visibility:function(a){f.send("set_control_visibility",a),e.set_control_visibility(a)},get_control_visibility:function(){return!0===e.get_control_visibility()},set_video_visibility:function(a){f.send("set_video_visibility",a),e.set_video_visibility(a)},get_video_visibility:function(){return!0===e.get_video_visibility()},set_scalemode:function(a){"|letterbox|stretch|zoom|none|".indexOf(a)>=0&&f.send("set_scalemode",a)},get_scalemode:function(){return e.get_scalemode()},set_speed:function(a){f.send("set_speed",parseFloat(Math.min(4,Math.max(.5,a))).toFixed(1))},get_speed:function(){return e.get_speed()},set_topmost:function(a){f.send("set_topmost",a?1:0)},get_topmost:function(){return e.get_topmost()},set_brightness:function(a){f.send("set_brightness",Math.min(50,Math.max(-50,a)))},get_brightness:function(){return e.get_video().brightness},set_contrast:function(a){f.send("set_contrast",Math.min(50,Math.max(-50,a)))},get_contrast:function(){return e.get_video().contrast},set_saturation:function(a){f.send("set_saturation",Math.min(50,Math.max(-50,a)))},get_saturation:function(){return e.get_video().saturation},set_repeat_start:function(a){f.send("set_sectiontime",{type:1,value:a})},set_repeat_end:function(a){f.send("set_sectiontime",{type:2,value:a})},unset_repeat:function(){f.send("set_sectiontime",{type:0,value:null})},refresh_bookmark:function(){f.send("refresh_bookmark")},enable_fullscreen_button:function(){f.send("enable_fullscreen_button")},get_player_id:function(){return e.get_player_id()},get_player_type:function(){return e.get_player_type()},get_hardware_id:function(){return e.get_hardware_id()},set_subtitle_visibility:function(a){f.send("set_subtitle_visibility",a)},get_video_info:function(){return e.get_video_info()},set_playback_rates:function(a){f.send("set_playback_rates",a)},get_playback_rates:function(){return JSON.parse(e.get_playback_rates())},set_lms_check:function(a){f.send("set_lms_check")},set_keyframe_seek_default:function(a){f.send("set_keyframe_seek_default",a)},set_short_key:function(a){f.send("set_short_key",a)},set_enable_close_event:function(a){e.set_enable_close_event(a),f.send("set_enable_close_event",a)},get_enable_close_event:function(){return e.get_enable_close_event()},set_close_callback_fn:function(a){e.set_close_callback_fn("("+a.toString()+")")},get_close_callback_fn:function(){return e.get_close_callback_fn()},get_lms_data:function(a){e.set_lms_data_callback_fn(a),f.send("get_lms_data")}}};window.VgControllerClient=VgControllerClient,window.Kollus=window.Kollus||{},window.Kollus.VideogatewayController=VgControllerClient;